<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Mon C≈ìur √† Distance üíï ‚Äî v2</title>
  <meta name="description" content="Un espace cosy pour les couples √† distance : messages, album photo, chat, activit√©s et souvenirs ‚Äî avec sauvegarde locale automatique." />
  <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ctext y='0.9em' font-size='90'%3E%F0%9F%92%95%3C/text%3E%3C/svg%3E" />
  <style>
    :root{
      --primary:#ff6b6b; --primary-600:#ff5252; --bg1:#667eea; --bg2:#764ba2;
      --panel:rgba(255,255,255,0.96); --text:#222; --muted:#666; --ring:#ffd6d6;
    }
    *{box-sizing:border-box}
    html,body{min-height:100%}
    body{
      font-family: system-ui, -apple-system, Segoe UI, Roboto, 'Helvetica Neue', Arial, 'Noto Sans', 'Apple Color Emoji','Segoe UI Emoji';
      background: linear-gradient(135deg,var(--bg1) 0%,var(--bg2) 100%);
      margin:0; color:var(--text);
    }
    .container{max-width:1100px;margin:auto;padding:24px}
    .header{color:#fff;text-align:center;margin:8px 0 18px}
    .header h1{margin:0;font-size:clamp(28px,4vw,48px);letter-spacing:.3px}
    .header p{margin:6px 0 0;opacity:.9}

    .card{background:var(--panel);border-radius:18px;box-shadow:0 10px 30px rgba(0,0,0,.20);padding:22px}
    .row{display:flex;flex-wrap:wrap;gap:12px}
    .btn{
      background:#fff;border:0;border-radius:999px;padding:12px 18px;cursor:pointer;
      transition:.2s; box-shadow:0 2px 10px rgba(0,0,0,.08);
    }
    .btn:hover{transform:translateY(-1px)}
    .btn.primary{background:var(--primary);color:#fff}
    .btn.warn{background:#ff9aa2;color:#fff}
    .btn.ghost{background:transparent;border:2px solid #fff;color:#fff}

    nav{display:none;justify-content:center;flex-wrap:wrap;gap:10px;margin:12px 0 22px}
    nav .tab{background:rgba(255,255,255,.9);border:0;border-radius:999px;padding:10px 16px;cursor:pointer}
    nav .tab.active{background:var(--primary);color:#fff}

    section.app{display:none}
    section.app.active{display:block;animation:fade .35s ease}
    @keyframes fade{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:none}}

    /* Connection */
    .connect-grid{display:grid;gap:16px}
    .field{display:flex;gap:10px;flex-wrap:wrap}
    .input{flex:1;min-width:260px;padding:12px 14px;border:2px solid #e6e6e6;border-radius:12px;font-size:16px}
    .hint{font-size:13px;color:#333;background:#fff7f7;border:1px dashed var(--ring);padding:10px;border-radius:10px}
    .kbd{font-family:monospace;background:#fff;border:1px solid #ddd;border-bottom-width:2px;border-radius:6px;padding:2px 6px}

    /* Messages du jour */
    .daily{font-size:18px;line-height:1.6;color:#444;font-style:italic;padding:16px;border-left:4px solid var(--primary);background:#fff7f7;border-radius:10px}

    /* Album */
    .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:14px}
    .frame{background:#fff;border-radius:12px;box-shadow:0 5px 15px rgba(0,0,0,.08);min-height:230px;display:flex;flex-direction:column;align-items:center;justify-content:center;border:2px dashed #ddd;position:relative;padding:12px;text-align:center}
    .frame.has-photo{border:2px solid var(--primary)}
    .frame img{max-width:100%;max-height:160px;border-radius:10px}
    .frame .actions{position:absolute;top:8px;right:8px;display:flex;gap:6px}
    .iconbtn{border:0;border-radius:8px;padding:6px 8px;background:#fff;box-shadow:0 1px 6px rgba(0,0,0,.1);cursor:pointer}

    /* Chat */
    .chatbox{height:380px;overflow:auto;background:#fafafa;border:2px solid #eee;border-radius:14px;padding:14px;margin-bottom:10px}
    .msg{max-width:70%;margin:8px 0;padding:10px 14px;border-radius:18px;word-wrap:break-word}
    .sent{background:var(--primary);color:#fff;margin-left:auto;border-bottom-right-radius:6px}
    .recv{background:#e9e9e9;color:#222;border-bottom-left-radius:6px}
    .chat-input{display:flex;gap:8px}

    /* Journal + cartes */
    textarea{width:100%;padding:12px;border:2px solid #eee;border-radius:12px;font:inherit;resize:vertical}
    .entry{background:#fff3e0;padding:14px;border-radius:12px;border-left:4px solid var(--primary);margin:10px 0}
    .entry small{color:var(--muted)}
    .postcard{background:#fff;border:2px solid var(--primary);border-radius:14px;padding:18px;position:relative;box-shadow:0 5px 15px rgba(0,0,0,.08);margin:10px 0}
    .stamp{position:absolute;top:10px;right:16px;background:var(--primary);color:#fff;border-radius:6px;padding:4px 8px;font-size:12px;transform:rotate(12deg)}

    /* Floating hearts */
    .floating-hearts{position:fixed;inset:0;pointer-events:none;z-index:1000}
    .heart{position:absolute;font-size:20px;color:var(--primary);animation:float 3s ease-in-out forwards}
    @keyframes float{from{transform:translateY(100vh) rotate(0)}to{transform:translateY(-80px) rotate(360deg);opacity:0}}

    @media (max-width:768px){ nav{gap:8px} .chatbox{height:55vh} }
  </style>
</head>
<body>
  <div class="floating-hearts" id="floating-hearts"></div>
  <div class="container">
    <header class="header">
      <h1>Mon C≈ìur √† Distance üíï</h1>
      <p>Votre cocon d'amour synchronis√© (sauvegarde locale automatique)</p>
    </header>

    <!-- Connexion / cr√©ation d'espace -->
    <section id="connect" class="card">
      <div class="connect-grid">
        <h2>üíï Bienvenue</h2>
        <p class="hint">Cr√©ez un <strong>espace couple</strong> avec un <strong>code secret</strong>. Partagez ce code √† votre partenaire pour qu'il/elle ouvre le m√™me espace sur son appareil. (Fonctionne hors-ligne, donn√©es stock√©es en local sur l'appareil.)</p>
        <div class="field">
          <input id="couple-name" class="input" placeholder="Nom du couple (ex. Marie & Pierre)"/>
          <input id="couple-code" class="input" placeholder="Code secret (min. 4 caract√®res)"/>
        </div>
        <div class="row">
          <button id="btn-create" class="btn primary">Cr√©er l'Espace</button>
          <button id="btn-join" class="btn">Rejoindre</button>
        </div>
        <div id="connect-info" style="display:none">
          <p><strong>Espace :</strong> <span id="info-name"></span> ¬∑ <strong>Code :</strong> <span class="kbd" id="info-code"></span></p>
          <div class="row"><button id="btn-enter" class="btn primary">Entrer</button> <button id="btn-copy" class="btn">Copier le code</button></div>
        </div>
      </div>
    </section>

    <!-- Navigation -->
    <nav id="nav">
      <button class="tab active" data-tab="messages">Messages du Jour</button>
      <button class="tab" data-tab="photos">Album Photo</button>
      <button class="tab" data-tab="chat">Chat Priv√©</button>
      <button class="tab" data-tab="activities">Activit√©s</button>
      <button class="tab" data-tab="journal">Journal</button>
      <button class="tab" data-tab="postcards">Cartes Postales</button>
      <button id="btn-logout" class="tab" style="background:#ff9aa2;color:#fff">D√©connexion</button>
    </nav>

    <!-- Messages du jour -->
    <section id="messages" class="app card active">
      <h2>üíå Message du Jour</h2>
      <p id="daily" class="daily">Je pense √† toi d√®s mon r√©veil, mon amour... Comment vas-tu aujourd'hui ?</p>
      <div class="row" style="margin-top:10px">
        <button id="btn-newmsg" class="btn primary">Nouveau message</button>
        <button id="btn-love" class="btn">Envoyer de l'Amour ‚ù§Ô∏è</button>
      </div>
    </section>

    <!-- Album photo -->
    <section id="photos" class="app card">
      <h2>üì∏ Notre Album Photo Partag√©</h2>
      <p>Ajoutez des moments du quotidien (images stock√©es en local). Cliquez sur un cadre pour importer une photo.</p>
      <div id="gallery" class="grid" aria-live="polite"></div>
      <div class="row" style="margin-top:10px"><button id="btn-addslot" class="btn primary">Ajouter un emplacement</button>
      <button id="btn-export" class="btn">Exporter l'espace (.json)</button>
      <input id="import-file" type="file" accept="application/json" style="display:none" />
      <button id="btn-import" class="btn">Importer</button></div>
      <input id="file-picker" type="file" accept="image/*" style="display:none" />
    </section>

    <!-- Chat -->
    <section id="chat" class="app card">
      <h2>üí¨ Chat Priv√©</h2>
      <div id="chatbox" class="chatbox" aria-live="polite"></div>
      <div class="chat-input">
        <input id="chat-input" class="input" placeholder="Tapez votre message‚Ä¶"/>
        <button id="btn-send" class="btn primary">Envoyer</button>
      </div>
    </section>

    <!-- Activit√©s -->
    <section id="activities" class="app card">
      <h2>üéÆ Activit√©s √† Distance</h2>
      <div class="grid">
        <div class="card" data-act="movie"><h3>üé¨ Film Ensemble</h3><p>Lancez un film en m√™me temps</p></div>
        <div class="card" data-act="game"><h3>üé≤ Jeux en Ligne</h3><p>Jouez ensemble</p></div>
        <div class="card" data-act="cooking"><h3>üë®‚Äçüç≥ Cuisine</h3><p>Pr√©parez le m√™me plat</p></div>
        <div class="card" data-act="reading"><h3>üìö Lecture</h3><p>Chapitre commun</p></div>
        <div class="card" data-act="music"><h3>üéµ Playlist</h3><p>√âcoute synchronis√©e</p></div>
        <div class="card" data-act="exercise"><h3>üèÉ‚Äç‚ôÄÔ∏è Sport</h3><p>S√©ance partag√©e</p></div>
      </div>
    </section>

    <!-- Journal -->
    <section id="journal" class="app card">
      <h2>üìñ Journal de Couple</h2>
      <textarea id="journal-text" placeholder="√âcrivez vos pens√©es‚Ä¶"></textarea>
      <div class="row" style="margin-top:8px"><button id="btn-add-entry" class="btn primary">Ajouter</button></div>
      <div id="entries"></div>
    </section>

    <!-- Cartes postales -->
    <section id="postcards" class="app card">
      <h2>üíå Cartes Postales Virtuelles</h2>
      <input id="pc-title" class="input" placeholder="Titre de la carte‚Ä¶" style="margin:6px 0"/>
      <textarea id="pc-text" placeholder="Votre message romantique‚Ä¶"></textarea>
      <div class="row" style="margin-top:8px"><button id="btn-pc" class="btn primary">Cr√©er</button></div>
      <div id="pc-list"></div>
    </section>
  </div>

  <script>
    /*****************
     * Donn√©es & Utils
     *****************/
    const LS_KEY = 'mcad.couples.v2';
    const $ = sel => document.querySelector(sel);
    const $$ = sel => Array.from(document.querySelectorAll(sel));
    const fmtDate = (d=new Date())=>d.toLocaleDateString('fr-FR',{year:'numeric',month:'long',day:'numeric'});
    const uid = ()=>Math.random().toString(36).slice(2,10);

    const loveMessages = [
      "Je pense √† toi d√®s mon r√©veil‚Ä¶ Comment vas-tu aujourd'hui ?",
      "Tu es ma joie chaque matin‚Ä¶ pr√™t¬∑e √† conqu√©rir cette journ√©e ?",
      "Chaque jour je t'aime un peu plus. üíï",
      "Ton sourire illumine ma journ√©e. ‚ú®",
      "Tu es tout pour moi. Raconte-moi ta journ√©e !",
      "Mon c≈ìur bat pour toi‚Ä¶ √Ä quoi penses-tu ?",
      "Avec toi, m√™me la distance fond. ü´∂"
    ];

    let db = JSON.parse(localStorage.getItem(LS_KEY) || '{}');
    let currentId = null; // coupleId

    function save(){ localStorage.setItem(LS_KEY, JSON.stringify(db)); }

    function ensureCouple(id){
      if(!db[id]) db[id] = { name:'', code:id, photos:[], messages:[], journal:[], postcards:[], created:new Date().toISOString() };
    }

    function setActiveApp(id){ $$('.app').forEach(s=>s.classList.toggle('active', s.id===id)); $$('.tab').forEach(b=>b.classList.toggle('active', b.dataset.tab===id)); }

    /*****************
     * Connexion
     *****************/
    $('#btn-create').addEventListener('click',()=>{
      const name = $('#couple-name').value.trim();
      const code = $('#couple-code').value.trim().toLowerCase();
      if(!name||!code) return alert('Veuillez remplir tous les champs.');
      if(code.length<4) return alert('Le code doit contenir au moins 4 caract√®res.');
      ensureCouple(code); db[code].name=name; currentId=code; save();
      $('#info-name').textContent = name; $('#info-code').textContent = code; $('#connect-info').style.display='block';
    });

    $('#btn-join').addEventListener('click',()=>{
      const code = $('#couple-code').value.trim().toLowerCase();
      if(!code) return alert('Entrez le code.');
      if(!db[code]) return alert('Code introuvable sur cet appareil. Si votre partenaire a un autre appareil, importez sa sauvegarde JSON.');
      currentId=code; $('#info-name').textContent=db[code].name||'Espace'; $('#info-code').textContent=code; $('#connect-info').style.display='block';
    });

    $('#btn-copy').addEventListener('click', async()=>{
      try{ await navigator.clipboard.writeText($('#info-code').textContent); alert('Code copi√© !'); }catch{ alert('Impossible de copier.'); }
    });

    $('#btn-enter').addEventListener('click',()=>{
      if(!currentId) return; $('#connect').style.display='none'; $('nav').style.display='flex';
      loadAll(); setActiveApp('messages');
    });

    $('#btn-logout').addEventListener('click',()=>{
      if(!confirm('Se d√©connecter ?')) return;
      currentId=null; $('nav').style.display='none'; $('#connect').style.display='block';
      $$('.app').forEach(s=>s.classList.remove('active'));
      $('#messages').classList.add('active');
    });

    /*****************
     * Navigation
     *****************/
    $$('.tab').forEach(btn=>btn.addEventListener('click',()=> setActiveApp(btn.dataset.tab)));

    /*****************
     * Messages du jour
     *****************/
    $('#btn-newmsg').addEventListener('click',()=>{
      const el=$('#daily');
      el.style.opacity=0; el.style.transform='translateY(-6px)';
      setTimeout(()=>{ el.textContent = loveMessages[Math.floor(Math.random()*loveMessages.length)]; el.style.opacity=1; el.style.transform=''; },220);
    });

    $('#btn-love').addEventListener('click',()=>{
      // floating hearts
      const cont = $('#floating-hearts');
      for(let i=0;i<10;i++) setTimeout(()=>{
        const h=document.createElement('div'); h.className='heart'; h.textContent='‚ù§Ô∏è';
        h.style.left=Math.random()*100+'%'; h.style.animationDelay=(Math.random()*1.5)+'s';
        cont.appendChild(h); setTimeout(()=>h.remove(),3000);
      }, i*80);
    });

    /*****************
     * Album photo (upload + base64 en local)
     *****************/
    const gallery = $('#gallery');
    const filePicker = $('#file-picker');

    function renderPhotos(){
      gallery.innerHTML='';
      const list = db[currentId].photos;
      if(list.length===0){ for(let i=0;i<3;i++) addSlot(); }
      db[currentId].photos.forEach((ph,idx)=>{
        const f=document.createElement('div'); f.className='frame'+(ph?.url?' has-photo':'');
        f.innerHTML = ph?.url ? `<div class="actions"><button class="iconbtn" data-act="replace">Remplacer</button><button class="iconbtn" data-act="del">Supprimer</button></div><img alt="Photo partag√©e" src="${ph.url}"><p>${ph.caption||'Photo du jour ‚ù§Ô∏è'}</p><small>Ajout√© le ${ph.date||fmtDate()}</small>` : `<div>üì∑</div><p>Ajouter une photo</p>`;
        f.addEventListener('click', (e)=>{
          if(e.target.dataset.act==='del'){ e.stopPropagation(); db[currentId].photos.splice(idx,1); save(); renderPhotos(); return; }
          pickAndLoad((dataUrl)=>{ const caption=prompt('L√©gende ?')||'Photo du jour ‚ù§Ô∏è'; db[currentId].photos[idx]={url:dataUrl,caption,date:fmtDate()}; save(); renderPhotos(); });
        });
        gallery.appendChild(f);
      });
    }

    function addSlot(){ db[currentId].photos.push({}); save(); }

    function pickAndLoad(cb){ filePicker.onchange=()=>{ const f=filePicker.files[0]; if(!f) return; const r=new FileReader(); r.onload=()=>cb(r.result); r.readAsDataURL(f); filePicker.value=''; }; filePicker.click(); }

    $('#btn-addslot').addEventListener('click',()=>{ addSlot(); renderPhotos(); });

    // Export / Import
    $('#btn-export').addEventListener('click',()=>{
      if(!currentId) return; const blob=new Blob([JSON.stringify(db[currentId],null,2)],{type:'application/json'});
      const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download=`${db[currentId].name||'espace'}-${currentId}.json`; a.click(); URL.revokeObjectURL(a.href);
    });
    $('#btn-import').addEventListener('click',()=> $('#import-file').click());
    $('#import-file').addEventListener('change',()=>{
      const f=$('#import-file').files[0]; if(!f) return; const r=new FileReader(); r.onload=()=>{
        try{ const obj=JSON.parse(r.result);
          if(!currentId){ alert('Cr√©ez/Rejoignez d\'abord un espace pour importer.'); return; }
          // Fusion simple
          const cur=db[currentId];
          cur.name = obj.name || cur.name; cur.photos = obj.photos||cur.photos; cur.messages=obj.messages||cur.messages; cur.journal=obj.journal||cur.journal; cur.postcards=obj.postcards||cur.postcards;
          save(); renderPhotos(); loadChat(); renderJournal(); renderPC(); alert('Import termin√© !');
        }catch(e){ alert('Fichier invalide.'); }
      }; r.readAsText(f); $('#import-file').value='';
    });

    /*****************
     * Chat (local, auto-r√©ponse mignonne)
     *****************/
    function loadChat(){
      const box=$('#chatbox'); box.innerHTML='';
      let msgs=db[currentId].messages; if(!msgs||msgs.length===0){ msgs=[{t:'recv',x:"Salut mon c≈ìur ! J'esp√®re que tu passes une belle journ√©e ‚ù§Ô∏è"},{t:'sent',x:'Oui, et toi ? Tu me rends si heureux/se ! üíï'}]; db[currentId].messages=msgs; save(); }
      msgs.forEach(m=>{
        const d=document.createElement('div'); d.className='msg '+(m.t==='sent'?'sent':'recv'); d.textContent=m.x; box.appendChild(d);
      }); box.scrollTop=box.scrollHeight;
    }

    $('#btn-send').addEventListener('click',sendMsg);
    $('#chat-input').addEventListener('keydown',e=>{ if(e.key==='Enter') sendMsg(); });

    function sendMsg(){
      const inp=$('#chat-input'); const txt=inp.value.trim(); if(!txt||!currentId) return; inp.value='';
      db[currentId].messages.push({t:'sent',x:txt,time:Date.now()}); save(); loadChat();
      // petite r√©ponse auto
      setTimeout(()=>{ const replies=["Tu me fais sourire ! üòä","Je t'aime aussi ‚ù§Ô∏è","H√¢te de te voir !","Merci pour ce message ! ü•∞","Tu illumines ma journ√©e ! ‚ú®"]; const r=replies[Math.floor(Math.random()*replies.length)]; db[currentId].messages.push({t:'recv',x:r,time:Date.now()}); save(); loadChat(); }, 800+Math.random()*1200);
    }

    /*****************
     * Journal
     *****************/
    function renderJournal(){ const cont=$('#entries'); cont.innerHTML=''; let j=db[currentId].journal; if(!j||j.length===0){ j=[{date:fmtDate(),text:"Aujourd'hui j'ai pens√© √† toi en voyant un magnifique coucher de soleil. ‚ù§Ô∏è"}]; db[currentId].journal=j; save(); }
      j.forEach((e,i)=>{ const div=document.createElement('div'); div.className='entry'; div.innerHTML=`<small>${e.date}</small><div>${e.text}</div>`; cont.appendChild(div); }); }
    $('#btn-add-entry').addEventListener('click',()=>{ const t=$('#journal-text').value.trim(); if(!t||!currentId) return; db[currentId].journal.unshift({date:fmtDate(),text:t}); save(); $('#journal-text').value=''; renderJournal(); });

    /*****************
     * Cartes postales
     *****************/
    function renderPC(){ const list=$('#pc-list'); list.innerHTML=''; let arr=db[currentId].postcards; if(!arr||arr.length===0){ arr=[{title:'Bonjour mon c≈ìur',text:"Chaque matin, je me r√©veille avec ton sourire dans mes pens√©es. Je t'aime infiniment ! üíï"}]; db[currentId].postcards=arr; save(); }
      arr.forEach(p=>{ const d=document.createElement('div'); d.className='postcard'; d.innerHTML=`<div class='stamp'>AMOUR</div><h3>${p.title}</h3><p>${p.text}</p>`; list.appendChild(d); }); }
    $('#btn-pc').addEventListener('click',()=>{ const t=$('#pc-title').value.trim(); const x=$('#pc-text').value.trim(); if(!t||!x||!currentId) return; db[currentId].postcards.unshift({title:t,text:x}); save(); $('#pc-title').value=''; $('#pc-text').value=''; renderPC(); });

    /*****************
     * Activit√©s (placeholder alert)
     *****************/
    $$('#activities .card').forEach(c=>c.addEventListener('click',()=>{
      const map={movie:'Choisissez un film et synchronisez le d√©part.',game:'On lance une partie ?',cooking:'Pr√©parez la m√™me recette ce soir !',reading:'Chapitre commun cette semaine.',music:'Cr√©ez une playlist partag√©e.',exercise:'S√©ance cardio en duo !'};
      alert(map[c.dataset.act]);
    }));

    /*****************
     * Chargement
     *****************/
    function loadAll(){ if(!currentId) return; renderPhotos(); loadChat(); renderJournal(); renderPC(); }

    // Hearts au chargement
    setTimeout(()=>$('#btn-love').click(), 900);
  </script>
</body>
</html>
